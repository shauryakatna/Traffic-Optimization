<!--
MkDocs version : 1.6.1
Build Date UTC : 08 May 2025 03:20:25
Last edit: 10 September 2024
-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta property="og:image" content="../images/image-facebook.jpg">
        <meta property="og:image:type" content="image/jpeg">
        <meta property="og:image:width" content="1080">
        <meta property="og:image:height" content="1080">

        
        
        <link rel="canonical" href="https://sumo.dlr.de/docs/Tutorials/CityMobil.html">
        <link rel="shortcut icon" href="../images/favicon.ico">
        <title>CityMobil - SUMO Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="apple-touch-icon" href="../images/apple-touch-icon.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-3.7.0.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 

      <script>
        // DARK MODE
        function detectColorScheme(){
          var theme="light";

          if(localStorage.getItem("sumo-docs-theme")){
              if(localStorage.getItem("sumo-docs-theme") == "dark"){
                  var theme = "dark";
              }
          } else if(!window.matchMedia) {
              return false;
          } else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
              var theme = "dark";
          }

          if (theme=="dark") {
              document.documentElement.setAttribute("data-theme", "dark");
          }
        }
        detectColorScheme();
      </script>

    </head>

    <body>

        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary text-center">
            <div class="container-fluid">
                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../index.html" class="nav-link">Documentation</a>
                            </li>
                            <li class="navitem">
                                <a href="index.html" class="nav-link">Tutorials</a>
                            </li>
                            <li class="navitem">
                                <a href="../FAQ.html" class="nav-link">FAQ</a>
                            </li>
                            <li class="navitem">
                                <a href="../Downloads.html" class="nav-link">Downloads</a>
                            </li>
                            <li class="navitem">
                                <a href="../Publications.html" class="nav-link">Publications</a>
                            </li>
                            <li class="navitem">
                                <a href="../Developer/index.html" class="nav-link">Developer</a>
                            </li>
                            <li class="navitem">
                                <a href="../ChangeLog.html" class="nav-link">ChangeLog</a>
                            </li>
                            <li class="navitem">
                                <a href="https://eclipse.dev/sumo/contact/" class="nav-link">Contact</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa-solid fa-magnifying-glass"></i> <u>S</u>earch
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="edit" href="https://github.com/eclipse-sumo/sumo/edit/main/docs/web/docs/Tutorials/CityMobil.md" class="nav-link"><i class="fa-brands fa-github"></i> <u>E</u>dit on GitHub</a>
                            </li>
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            More <i class="fa-solid fa-circle-chevron-down"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item no-arrow-link" href="https://github.com/eclipse/sumo/issues">Report a Bug / Issue / Typo</a>
                            <a class="dropdown-item" href="../Editing_Articles.html">Help on editing articles</a>
                            <a class="dropdown-item" href="https://github.com/eclipse/sumo/commits/main/docs/web">Recent documentation changes</a>
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#mkdocs_keyboard_modal">Keyboard Shortcuts</a>
                            <a class="dropdown-item no-arrow-link" href="https://sumo.dlr.de/sumo_documentation.zip">Download the Documentation</a>
                            <span class="dropdown-item" id="dark-mode-div">Dark mode <label id="theme-switch" class="theme-switch" for="checkbox_theme">
                              <input type="checkbox" id="checkbox_theme">
                          </label></span>
                          </div>
                        </li>
                        <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" id="languagedrop" data-toggle="dropdown">
                            <i class="fa-solid fa-language"></i> Languages <i class="fa-solid fa-circle-chevron-down"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right">
                            <span class="dropdown-item">
                              Translations are generated automatically by Google Translate:
                            </span>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=en&_x_tr_tl=de">Deutsch</a>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=en&_x_tr_tl=es">Español</a>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=en&_x_tr_tl=fr">Français</a>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=en&_x_tr_tl=it">Italiano</a>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=en&_x_tr_tl=zh-CN">简体中文</a>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=en&_x_tr_tl=zh-TW">繁體中文</a>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=en&_x_tr_tl=tr">Türkçe</a>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=en&_x_tr_tl=ja">日本語</a>
                            <a class="dropdown-item" href="https://sumo-dlr-de.translate.goog/docs/Tutorials/CityMobil.html?_x_tr_sl=auto&_x_tr_tl=en"><i class="fa-solid fa-arrow-right"></i> Other languages</a>
                          </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid">
          <div class="row">
                <div class="col-md-3">
                  <div class="text-center"><a href="../index.html" style="display: inline-block; margin-top: 5px;"><img src="../images/sumo-logo.png" class="sumoLogo" alt="SUMO Logo" width="120px"></a></div>
                  
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed mb-1" data-toggle="collapse" data-target="#toc-collapse" title="Contents">
            <span class="fa-solid fa-angle-down"></span>
        </button>
    </div>
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary toc-scroll toc">
        <ul class="nav flex-column bs-sidenav">
            <p style="margin-top:5px; color:#777777;" class="text-center">Contents</p>
            <li class="nav-item main"><a href="#the_scenario">The Scenario</a></li>
            <li class="nav-item main"><a href="#network_building">Network building</a></li>
            <li class="nav-item main"><a href="#additional_infrastructure_and_vehicle_types">Additional infrastructure and vehicle types</a></li>
            <li class="nav-item main"><a href="#traffic_demand">Traffic Demand</a></li>
            <li class="nav-item main"><a href="#running_the_scenario_generation_and_the_scenario">Running the scenario generation and the scenario</a></li>
            <li class="nav-item main"><a href="#description_of_the_dispatching_algorithm">Description of the dispatching algorithm</a></li>
            <li class="nav-item main"><a href="#evaluation">Evaluation</a></li>
            <li class="nav-item main"><a href="#comparison_with_a_simple_bus">Comparison with a simple bus</a></li>
        </ul>
    </div>

    <div class="admonition conference" style="position: sticky; margin-top: 20px; margin-bottom:10px;">
        <p>visit <a class="no-arrow-link" href="https://eclipse.dev/sumo">eclipse.dev/sumo</a></p>
    </div>

    <div class="admonition" style="position: sticky; margin-top: 20px; margin-bottom:10px; background-color: #e6e6e6; border-color: #F1F3DE; padding: 0;">
        <center>
            <a class="no-arrow-link" href="https://eclipse.dev/sumo/conference"><img src="../images/SUMO2025.png" alt="SUMO User Conference 2025" class="img-fluid" style="max-height: 200px"></a>
        </center>
    </div>

</div>
                </div>
                <div class="col-md-9 main-area" role="main">
                   <!-- page.is_homepage seems to be broken in Mkdocs > 1.1.0 -->
                  <ul class="breadcrumbs">
    <script>
        var pagePath = "/docs/Tutorials/CityMobil.html";
        var splitUrl = pagePath.split("/");
        splitUrl.pop();
        splitUrl.shift();
        if (splitUrl[0] == 'docs') splitUrl.shift();
        var homeLink = "../index.html";
        document.write('<li class="breadcrumb-item"><a href="' + homeLink + '"><i class="fa-solid fa-house"></i></a></li>');
        var prev = '';

        var dirLink = splitUrl.map(function (el) {
        el = prev + el; prev = el + '/'; return el;
        });

        for (let i = 0; i < splitUrl.length; i++) {
            document.write("<li class=\"breadcrumb-item\"><a class=\"no-arrow-link\" href=\"../" + dirLink[i] + "\">" + splitUrl[i] + "</a></li>");
        }
    </script>
    <li class="breadcrumb-item active">CityMobil</li>
</ul>
                  <hTitles>CityMobil<hr style="border: 0.5px solid #338033; margin-top: 5px !important;"></hTitles>
                  
                  

<p>The <em>city_mobil</em> subdirectory in <strong><em>&lt;SUMO_HOME&gt;</em></strong>/docs/tutorial contains the setup for
a simulation of a parking lot using sumo with its taxi device to build a demand
responsive transport service. Most of the files in the directory are for the
<a href="CityMobil_old.html">old CityMobil tutorial</a>,
for the new version only <code>createNetTaxi.py</code> is relevant.</p>
<p>This tutorial explains how to build such a scenario programmatically by generating
all input files with a (python) script we call <code>createNetTaxi.py</code>. The easiest way
to follow it, is probably to read the existing code side by side with this tutorial
since not every line will be covered here. Some basic knowledge of Python is assumed.</p>
<p>Most parameters for the application (including the paths to the
executables) are in <code>constants.py</code> and can be easily adapted there to modify the scenario.
These parameters are written in ALL_CAPS below.</p>
<p>At the start of our script we will import those constants as well as modifying the
system path to be able to use the sumolib (this is optional if you installed sumolib via
pip).</p>
<div class="codehilite"><pre><span></span><code><span class="o">...</span> <span class="c1"># more imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">PREFIX</span><span class="p">,</span> <span class="n">DOUBLE_ROWS</span><span class="p">,</span> <span class="n">ROW_DIST</span><span class="p">,</span> <span class="n">SLOTS_PER_ROW</span><span class="p">,</span> <span class="n">SLOT_WIDTH</span>
<span class="o">...</span> <span class="c1"># more constants</span>
<span class="k">if</span> <span class="s1">&#39;SUMO_HOME&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SUMO_HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;tools&#39;</span><span class="p">))</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sumolib</span>
</code></pre></div>

<h2 id="the_scenario">The Scenario<a class="headerlink" href="#the_scenario" title="Permanent link">#</a></h2>
<p><img alt="" src="../images/citymobil.png" title="CityMobil scenario" /></p>
<p>The setup consists of a parking lot with access streets in several rows and parking
areas on both sides of the road. Vehicles with passengers arrive on the main street
in the lower left corner, drive to a parking lot where the passengers exit, and walk
to a bus stop on the top road where an automated shuttle service brings them to their
final destination in the upper right corner. The shuttle service will be demand driven,
so it will only stop when passengers want to enter or leave.</p>
<h2 id="network_building">Network building<a class="headerlink" href="#network_building" title="Permanent link">#</a></h2>
<p>The main parameters of the network are the number of (double) rows the parking lot has
(DOUBLE_ROWS), the number of slots per row (SLOTS_PER_ROW) and the distance of the rows
(ROW_DIST). They define the layout assuming a fixed width of each slot.</p>
<p>We generate a node file defining the positions of the junctions and an edge file
specifying the connections between the nodes together with parameters such as the
number of lanes and the allowed vehicle classes.</p>
<p>We open the files as standard text files and use a helper function from the sumolib to
write the XML header:</p>
<div class="codehilite"><pre><span></span><code><span class="n">nodes</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.nod.xml&quot;</span> <span class="o">%</span> <span class="n">PREFIX</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">sumolib</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">writeHeader</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">)</span>
</code></pre></div>

<p>This results in a header like this in our node file:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cm">&lt;!-- generated on 2020-09-01 11:03:05.263997 by createNetTaxi.py v1_6_0+1864-1ecf301a37</span>
<span class="cm">  options:</span>
<span class="cm">--&gt;</span>
<span class="nt">&lt;nodes</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;https://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="w"> </span><span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">&quot;https://sumo.dlr.de/xsd/nodes_file.xsd&quot;</span><span class="nt">&gt;</span>
</code></pre></div>

<p>This gives complete information on how and when this file has been generated as well
as a schema reference which allows for validating the input. This makes it easier to find mistakes
such as typing errors in attribute names which could otherwise go unnoticed.</p>
<p>After opening the edges file in the same way we can start writing the node and edge definitions.
We first define a starting point for the insertion edge which is located 100m to the
left of the first parking row and then one junction at the start of
each double row:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;node id=&quot;in&quot; x=&quot;-100&quot; y=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DOUBLE_ROWS</span><span class="p">):</span>
    <span class="n">nextNodeID</span> <span class="o">=</span> <span class="s2">&quot;main</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">row</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">row</span> <span class="o">*</span> <span class="n">ROW_DIST</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;node id=&quot;</span><span class="si">%s</span><span class="s1">&quot; x=&quot;</span><span class="si">%s</span><span class="s1">&quot; y=&quot;0&quot;/&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nextNodeID</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span>
</code></pre></div>

<p>We can generate the edges in the same loop, which extends the code to:</p>
<div class="codehilite"><pre><span></span><code><span class="n">nodeID</span> <span class="o">=</span> <span class="s2">&quot;main0&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;node id=&quot;in&quot; x=&quot;-100&quot; y=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;edge id=&quot;mainin&quot; from=&quot;in&quot; to=&quot;</span><span class="si">%s</span><span class="s1">&quot; numLanes=&quot;2&quot;/&gt;&#39;</span> <span class="o">%</span> <span class="n">nodeID</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DOUBLE_ROWS</span><span class="p">):</span>
    <span class="n">nextNodeID</span> <span class="o">=</span> <span class="s2">&quot;main</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">row</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">row</span> <span class="o">*</span> <span class="n">ROW_DIST</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;node id=&quot;</span><span class="si">%s</span><span class="s1">&quot; x=&quot;</span><span class="si">%s</span><span class="s1">&quot; y=&quot;0&quot;/&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nextNodeID</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;edge id=&quot;main</span><span class="si">%s</span><span class="s1">to</span><span class="si">%s</span><span class="s1">&quot; from=&quot;</span><span class="si">%s</span><span class="s1">&quot; to=&quot;</span><span class="si">%s</span><span class="s1">&quot; numLanes=&quot;2&quot;/&gt;&#39;</span> <span class="o">%</span>
              <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">nodeID</span><span class="p">,</span> <span class="n">nextNodeID</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
    <span class="n">nodeID</span> <span class="o">=</span> <span class="n">nextNodeID</span>
</code></pre></div>

<p>Note that we need to keep track of the id of the previous node and we need one
edge less than nodes. The edge has almost no additional parameters except for the
number of lanes, which is 2 to allow for overtaking vehicles which slowly turn
into the lot.</p>
<p>The code for the (cyber)bus edges follows the same pattern but is a little bit
more involved because it needs also a street in the opposite direction since the busses
need to turn around. Furthermore it needs a sidewalk (modelled as a lane for pedestrians).
The code for generating a forward and back connection between two parking streets is:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;edge id=&quot;</span><span class="si">%s</span><span class="s2">&quot; from=&quot;cyber</span><span class="si">%s</span><span class="s2">&quot; to=&quot;cyber</span><span class="si">%s</span><span class="s2">&quot; numLanes=&quot;3&quot; spreadType=&quot;center&quot;&gt;</span>
<span class="s2">    &lt;lane index=&quot;0&quot; allow=&quot;pedestrian&quot; width=&quot;2.00&quot;/&gt;</span>
<span class="s2">    &lt;lane index=&quot;1&quot; allow=&quot;taxi bus&quot;/&gt;</span>
<span class="s2">    &lt;lane index=&quot;2&quot; allow=&quot;taxi bus&quot;/&gt;</span>
<span class="s2">&lt;/edge&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edgeID</span><span class="p">,</span> <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;edge id=&quot;-</span><span class="si">%s</span><span class="s2">&quot; from=&quot;cyber</span><span class="si">%s</span><span class="s2">&quot; to=&quot;cyber</span><span class="si">%s</span><span class="s2">&quot; numLanes=&quot;2&quot; spreadType=&quot;center&quot;&gt;</span>
<span class="s2">    &lt;lane index=&quot;0&quot; allow=&quot;taxi bus&quot;/&gt;</span>
<span class="s2">    &lt;lane index=&quot;1&quot; allow=&quot;taxi bus&quot;/&gt;</span>
<span class="s2">&lt;/edge&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edgeID</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
</code></pre></div>

<p>Note that the back leading streets do not have a side walk because the passengers are
only allowed to enter and leave on the side of the parking lot.</p>
<p>Now we only need the vertical running streets and we are done with the basic network.
Here we do not need further nodes - we only connect the existing parts - but we need
sidewalks again on both sides for the people to walk to the bus.</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DOUBLE_ROWS</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;edge id=&quot;road</span><span class="si">%s</span><span class="s2">&quot; from=&quot;main</span><span class="si">%s</span><span class="s2">&quot; to=&quot;cyber</span><span class="si">%s</span><span class="s2">&quot; numLanes=&quot;2&quot;&gt;</span>
<span class="s2">    &lt;lane index=&quot;0&quot; allow=&quot;pedestrian&quot; width=&quot;2.00&quot;/&gt;</span>
<span class="s2">    &lt;lane index=&quot;1&quot; disallow=&quot;pedestrian&quot;/&gt;</span>
<span class="s2">&lt;/edge&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;edge id=&quot;-road</span><span class="si">%s</span><span class="s2">&quot; from=&quot;cyber</span><span class="si">%s</span><span class="s2">&quot; to=&quot;main</span><span class="si">%s</span><span class="s2">&quot; numLanes=&quot;2&quot;&gt;</span>
<span class="s2">    &lt;lane index=&quot;0&quot; allow=&quot;pedestrian&quot; width=&quot;2.00&quot;/&gt;</span>
<span class="s2">    &lt;lane index=&quot;1&quot; disallow=&quot;pedestrian&quot;/&gt;</span>
<span class="s2">&lt;/edge&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
</code></pre></div>

<p>Now we can close the files and run netconvert:</p>
<div class="codehilite"><pre><span></span><code><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">sumolib</span><span class="o">.</span><span class="n">checkBinary</span><span class="p">(</span><span class="s1">&#39;netconvert&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.nod.xml&#39;</span> <span class="o">%</span> <span class="n">PREFIX</span><span class="p">,</span>
                 <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.edg.xml&#39;</span> <span class="o">%</span> <span class="n">PREFIX</span><span class="p">,</span>
                 <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.net.xml&#39;</span> <span class="o">%</span> <span class="n">PREFIX</span><span class="p">])</span>
</code></pre></div>

<p>You can already open the resulting network with netedit or sumo-gui
and it will look like the picture above except for the parking slots and the
bus stops which we add next.</p>
<h2 id="additional_infrastructure_and_vehicle_types">Additional infrastructure and vehicle types<a class="headerlink" href="#additional_infrastructure_and_vehicle_types" title="Permanent link">#</a></h2>
<p>For the bus stops and the parking areas we use a so called additional file
which we open and write a header like above. The definition of the parking areas
looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DOUBLE_ROWS</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;parkingArea id=&quot;ParkArea</span><span class="si">%s</span><span class="s2">&quot; lane=&quot;road</span><span class="si">%s</span><span class="s2">_1&quot;</span>
<span class="s2">                 roadsideCapacity=&quot;</span><span class="si">%s</span><span class="s2">&quot; angle=&quot;270&quot; length=&quot;8&quot;/&gt;</span>
<span class="s2">    &lt;parkingArea id=&quot;ParkArea-</span><span class="si">%s</span><span class="s2">&quot; lane=&quot;-road</span><span class="si">%s</span><span class="s2">_1&quot;</span>
<span class="s2">                 roadsideCapacity=&quot;</span><span class="si">%s</span><span class="s2">&quot; angle=&quot;270&quot; length=&quot;8&quot;/&gt;&quot;&quot;&quot;</span> <span class="o">%</span>
          <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">SLOTS_PER_ROW</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">SLOTS_PER_ROW</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">stops</span><span class="p">)</span>
</code></pre></div>

<p>Here we use a small trick. Since sumo attaches the parking lot to the vehicle lane (which is not the rightmost) it
would block (only visually but still) the sidewalk, so we enlarge the slots a little to 8m and define an
angle which lets all vehicles park forward leaving some space for the pedestrians.</p>
<p>For the bus stops the only small surprise is that we need one less than parking lots because they are only
in between the parking roads.</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DOUBLE_ROWS</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">edgeID</span> <span class="o">=</span> <span class="s2">&quot;cyber</span><span class="si">%s</span><span class="s2">to</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    &lt;busStop id=&quot;</span><span class="si">%s</span><span class="s1">stop&quot; lane=&quot;</span><span class="si">%s</span><span class="s1">_1&quot; startPos=&quot;2&quot; endPos=&quot;12&quot;/&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">edgeID</span><span class="p">,</span> <span class="n">edgeID</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">stops</span><span class="p">)</span>
</code></pre></div>

<p>Now we could close the additional file and already load it to the see the infrastructure.</p>
<p>We will however reuse the additional file to start defining the vehicles (at least the vehicle types).
Most of the vehicle type definition is for the look (the color) and the vehicle class such that
it will only use the right roads. The cyber car also has a taxi device to react to passenger requests.
We will also define a regular bus to allow for comparisons with a regular bus service in further iterations
of this tutorial.</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">((</span><span class="s2">&quot;&quot;&quot;    &lt;vType id=&quot;car&quot; color=&quot;0.7,0.7,0.7&quot;/&gt;</span>
<span class="s2">    &lt;vType id=&quot;ped_pedestrian&quot; vClass=&quot;pedestrian&quot; color=&quot;1,0.2,0.2&quot;/&gt;</span>
<span class="s2">    &lt;vType id=&quot;cybercar&quot; vClass=&quot;taxi&quot; length=&quot;</span><span class="si">%s</span><span class="s2">&quot; minGap=&quot;1&quot; guiShape=&quot;evehicle&quot; maxSpeed=&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
<span class="s2">           color=&quot;green&quot; emissionClass=&quot;HBEFA2/P_7_7&quot; personCapacity=&quot;</span><span class="si">%s</span><span class="s2">&quot;&gt;</span>
<span class="s2">        &lt;param key=&quot;has.taxi.device&quot; value=&quot;true&quot;/&gt;</span>
<span class="s2">    &lt;/vType&gt;</span>
<span class="s2">    &lt;vType id=&quot;bus&quot; vClass=&quot;bus&quot; color=&quot;blue&quot; personCapacity=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">CYBER_LENGTH</span><span class="p">,</span> <span class="n">CYBER_SPEED</span><span class="p">,</span> <span class="n">CYBER_CAPACITY</span><span class="p">,</span> <span class="n">BUS_CAPACITY</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">stops</span><span class="p">)</span>
</code></pre></div>

<p>Now we are ready to define the traffic demand.</p>
<h2 id="traffic_demand">Traffic Demand<a class="headerlink" href="#traffic_demand" title="Permanent link">#</a></h2>
<p>We define the cybercars and the passenger vehicles in different route files. For the cybercars, a simple flow is enough:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    &lt;flow id=&quot;c&quot; type=&quot;cybercar&quot; begin=&quot;50&quot; period=&quot;100&quot; number=&quot;</span><span class="si">%s</span><span class="s2">&quot; line=&quot;taxi&quot;&gt;</span>
<span class="s2">        &lt;route edges=&quot;cyberin cyber0to1&quot;/&gt;</span>
<span class="s2">    &lt;/flow&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">TOTAL_CAPACITY</span> <span class="o">//</span> <span class="n">CYBER_CAPACITY</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">routes</span><span class="p">)</span>
</code></pre></div>

<p>The only special thing here is the line which uses the reserved string "taxi" to denote that this will be a demand driven
transport system answering to special transportation requests. This specialty will also take care of the fact that
the vehicle should not leave the scenario after it reached the end of its initial route but wait for new requests.</p>
<p>The persons are slightly more complex as they arrive in their own car, drive to the parking lot, leave the car, walk to
the bus stop and then enter the cybercar to got to their final destination. We do everything here in two nested loops
because we want to fill all slots of all rows.</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SLOTS_PER_ROW</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DOUBLE_ROWS</span><span class="p">):</span>
</code></pre></div>

<p>Since the persons need to start in their car we need to define the cars first:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    &lt;trip id=&quot;v</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot; type=&quot;car&quot; depart=&quot;</span><span class="si">%s</span><span class="s2">&quot; from=&quot;mainin&quot; to=&quot;road</span><span class="si">%s</span><span class="s2">&quot;&gt;</span>
<span class="s2">        &lt;stop parkingArea=&quot;ParkArea</span><span class="si">%s</span><span class="s2">&quot; duration=&quot;1000&quot;/&gt;</span>
<span class="s2">    &lt;/trip&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span> <span class="o">*</span> <span class="n">period</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">routes</span><span class="p">)</span>
</code></pre></div>

<p>Now we generate a random number of passengers per car each with her own plan:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    &lt;person id=&quot;</span><span class="si">%s</span><span class="s2">p</span><span class="si">%s</span><span class="s2">&quot; type=&quot;ped_pedestrian&quot; depart=&quot;triggered&quot;&gt;</span>
<span class="s2">        &lt;ride from=&quot;mainin&quot; to=&quot;</span><span class="si">%s</span><span class="s2">road</span><span class="si">%s</span><span class="s2">&quot; lines=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">        &lt;walk busStop=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">        &lt;ride to=&quot;cyberout&quot; lines=&quot;taxi&quot;/&gt;</span>
<span class="s2">    &lt;/person&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vehId</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">infix</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">vehId</span><span class="p">,</span> <span class="n">busStop</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">routes</span><span class="p">)</span>
</code></pre></div>

<p>The first ride uses the private vehicle to the parking lot, then we walk to the
bus stop and ride with the cybercar. The "triggered" depart is needed to let the
person start in the car.</p>
<p>That's already it! We sum up everything in writing a nice configuration file which binds together the network,
the additional file (for stops and parking lots), the cyber-route file and the passenger route file.</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;configuration&gt;</span>
<span class="s2">    &lt;input&gt;</span>
<span class="s2">        &lt;net-file value=&quot;</span><span class="si">%s</span><span class="s2">.net.xml&quot;/&gt;</span>
<span class="s2">        &lt;route-files value=&quot;</span><span class="si">%s</span><span class="s2">_cyber.rou.xml,</span><span class="si">%s</span><span class="s2">_demand</span><span class="si">%02i</span><span class="s2">.rou.xml&quot;/&gt;</span>
<span class="s2">        &lt;additional-files value=&quot;</span><span class="si">%s</span><span class="s2">.add.xml&quot;/&gt;</span>
<span class="s2">        &lt;no-step-log value=&quot;True&quot;/&gt;</span>
<span class="s2">        &lt;time-to-teleport value=&quot;0&quot;/&gt;</span>
<span class="s2">        &lt;device.taxi.dispatch-algorithm value=&quot;routeExtension&quot;/&gt;</span>
<span class="s2">    &lt;/input&gt;</span>
<span class="s2">&lt;/configuration&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PREFIX</span><span class="p">,</span> <span class="n">PREFIX</span><span class="p">,</span> <span class="n">PREFIX</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">PREFIX</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>

<p>One thing to note here is the usage of the dispatch algorithm which will determine how the cybercars choose
which request to serve next.</p>
<h2 id="running_the_scenario_generation_and_the_scenario">Running the scenario generation and the scenario<a class="headerlink" href="#running_the_scenario_generation_and_the_scenario" title="Permanent link">#</a></h2>
<p>Now finally we can run by double clicking the script or if you are on a Linux / MacOS console:</p>
<div class="codehilite"><pre><span></span><code>./createNetTaxi.py
</code></pre></div>

<p>It will create configuration files for the different demands
which you can open and run with sumo-gui (again double click or from the console):</p>
<div class="codehilite"><pre><span></span><code>sumo-gui park05_cyber.sumocfg
</code></pre></div>

<p>Feel free to change the layout of the parking lot and the behavior
(speed, capacity etc.) of the vehicles. Whenever you edit <code>constants.py</code>
or <code>createNetTaxi.py</code>, remember to re-execute <code>createNetTaxi.py</code> before running the scenario.</p>
<h2 id="description_of_the_dispatching_algorithm">Description of the dispatching algorithm<a class="headerlink" href="#description_of_the_dispatching_algorithm" title="Permanent link">#</a></h2>
<p>TBD</p>
<h2 id="evaluation">Evaluation<a class="headerlink" href="#evaluation" title="Permanent link">#</a></h2>
<p>TBD</p>
<h2 id="comparison_with_a_simple_bus">Comparison with a simple bus<a class="headerlink" href="#comparison_with_a_simple_bus" title="Permanent link">#</a></h2>
<p>TBD</p>
                </div>
          </div>
          <button onclick="goTopFunction()" id="goToTop" title="Go to top"><i class="fa-solid fa-arrow-up"></i></button>
        </div>

        <footer class="col-md-12">
          
            <br><small><i>This page was last edited on: 10 September 2024</i></small>
          
          <hr>
            <p>Copyright &copy; 2001-2025 German Aerospace Center (DLR) and others.</p>
          <p>Follow us on <a class="no-arrow-link" href="https://www.twitter.com/eclipsesumo/"><i class="fa-brands fa-x-twitter"></i></a> <a class="no-arrow-link" href="https://www.facebook.com/simulationofurbanmobility/"><i class="fa-brands fa-facebook"></i></a> <a class="no-arrow-link" href="https://www.instagram.com/eclipse.sumo/"><i class="fa-brands fa-instagram"></i></a> <a class="no-arrow-link" href="https://www.threads.net/@eclipse.sumo"><i class="fa-brands fa-threads"></i></a>
          | Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a></p>
        </footer>

      <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body" style="color: #495057 !important;">
                <p>Enter your search terms:</p>
                <script async src="https://cse.google.com/cse.js?cx=004302551366764109984:1kpgtzrm6kv"></script>
                <div class="gcse-search"></div>
            </div>
        </div>
    </div>
</div>
      <script>
        window.onscroll = function() {scrollFunction()};

        function scrollFunction() {
          if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("goToTop").style.display = "block";
          } else {
            document.getElementById("goToTop").style.display = "none";
          }
        }

        function goTopFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        }

        var base_url = "..",
            shortcuts = {"edit": 69, "help": 191, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>

        <script>
          const toggleSwitch = document.querySelector('#theme-switch input[type="checkbox"]');

          function switchTheme(e) {
              if (e.target.checked) {
                  localStorage.setItem('sumo-docs-theme', 'dark');
                  document.documentElement.setAttribute('data-theme', 'dark');
                  toggleSwitch.checked = true;
              } else {
                  localStorage.setItem('sumo-docs-theme', 'light');
                  document.documentElement.setAttribute('data-theme', 'light');
                  toggleSwitch.checked = false;
              }
          }

          toggleSwitch.addEventListener('change', switchTheme, false);

          if (document.documentElement.getAttribute("data-theme") == "dark"){
              toggleSwitch.checked = true;
          }
          </script>

      <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Key</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody style="color: #495057 !important;">
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help dialog</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search the Documentation</td>
                  </tr>
                  <tr>
                    <td class="edit shortcut"><kbd>e</kbd></td>
                    <td>Edit current page on GitHub</td>
                  </tr>
                </tbody>
              </table>
            </div>
        </div>
    </div>
</div>
    </body>
</html>